---
title: 完全Jekyll化
layout: home
---

## 起因

图片不能点击放大!

搜索资料发现, 需要修改不少 `HTML` 代码, 想了想还是直接重新构建整个网站吧!

## 重新构建

新方案采用 `Jekyll` + `Plugins` + `Github Action` 来进行网站的部署

## 本地部署

`Jekyll` 的安装过程见上一篇文章`在本地测试个人网站`

### 创建

```sh
jekyll new blog
---
New jekyll site installed in E:/Codes/blog
```

### 部署

```sh
jekyll serve
---
jekyll-4.2.2/lib/jekyll/commands/serve/servlet.rb:3:in `require': cannot load such file -- webrick (LoadError)
```

emm...? 搜索了一下, 原来 `Ruby` 在 `3.0` 以后不再附带 `webrick` 了

#### 添加 `webrick`

```sh
bundle add webrick
```

```sh
jekyll serve
---
Server address: http://127.0.0.1:4000/
```

这下正常了, 访问 <http://127.0.0.1:4000/> 查看页面效果
![InitalJekyll](/assets/InitalJekyll.png)

### Cleanup

```sh
tree \f
---
blog
├─assets
├─_includes
├─_layouts
├─_sass
│  .gitignore
│  404.html
│  Gemfile
│  Gemfile.lock
│  Index.md
│  _config.yml
```

清理无用的文件

`_config.yml`

```yml
# Site settings
title: 明理
author: Windmill-City
email: 1449182174@qq.com
description: >-
  简单的规则构造出复杂的系统
baseurl: ""
url: "https://windmill-city.github.io/"
```

`Index.md`

{% raw %}

```md
---
layout: home
title: 主页
permalink: /
---

>{{ site.description }}

```

{% endraw %}

`Gemfile`

```gem
source "https://rubygems.org"
gem "jekyll", "~> 4.2.2"
group :jekyll_plugins do
end

# Windows and JRuby does not include zoneinfo files, so bundle the tzinfo-data gem
# and associated library.
platforms :mingw, :x64_mingw, :mswin, :jruby do
  gem "tzinfo", "~> 1.2"
  gem "tzinfo-data"
end

# Performance-booster for watching directories on Windows
gem "wdm", "~> 0.1.1", :platforms => [:mingw, :x64_mingw, :mswin]

# Lock `http_parser.rb` gem to `v0.6.x` on JRuby builds since newer versions of the gem
# do not have a Java counterpart.
gem "http_parser.rb", "~> 0.6.0", :platforms => [:jruby]

# Webserver library
gem "webrick", "~> 1.7"
```

#### 再次查看效果

```sh
jekyll serve
---
Server address: http://127.0.0.1:4000/
```

![PageAfterCleanup](/assets/PageAfterCleanup.png)

正确显示啦！接下来就是以此为基线进行 `Gitbook` 页面的制作了

## 页面制作

| 页面构成 |          |
| :------: | :------: |
| **侧栏** | **文章** |
|   搜索   |   标题   |
|   目录   | Metadata |
| 页面导航 |   内容   |

### 主体框架

先进行 `文章` 部分的制作

`home.html`

{% raw %}

```html
<!DOCTYPE html>
<html>

<head>
    <title>{{ page.title }}·{{ site.title }}</title>
</head>

<body>
    <div class="page">
        <!--Title-->
        <h1>{{ page. title }}</h1>
        <!--Metadata-->
        <header class="meta">
            <ul>
                <!--Author-->
                <li class="author">
                    {{ page.author | default: site.author }}
                </li>
                <!--Date-->
                {% if page.date %}
                <li class="date">
                    {{ page.date | date: "%Y-%m-%d" }}
                </li>
                {% endif %}
                <!--Categories-->
                <ul class="categories">
                    {% for category in page.categories %}
                    <li>
                        {{ category }}
                    </li>
                    {% endfor %}
                </ul>
            </ul>
        </header>
        <!--Markdown Content-->
        <section class="content">
            {{ page.content }}
        </section>
    </div>
</body>

</html>
```

{% endraw %}

![homeNoCss](/assets/homeNoCss.png)

嗯! 页面的主体结构出来了, 接下来为它附加 `CSS` 效果

### CSS

```diff
--- a/_layouts/home.html
+++ b/_layouts/home.html
@@ -3,6 +3,8 @@

 <head>
     <title>{{ page.title }}·{{ site.title }}</title>
+    <!--CSS Style Sheets-->
+    <link rel="stylesheet" href="/assets/css/styles.css" />
 </head>
```

`styles.sass`

```diff
+++ b/assets/css/styles.sass
@@ -0,0 +1,3 @@
+---
+---
+@import page
```

`styles.sass` 作为所有 `scss` 文件的集合

由于 `Front Matter` 的存在, 使用 `scss` 在格式化时会出问题, 这里使用 `sass`

`page.scss`

```diff
+++ b/_sass/page.scss
@@ -0,0 +1,3 @@
+.page {
+    background-color: #eee;
+}
```

这里先修改一下背景颜色作为测试

```diff
--- a/Index.md
+++ b/Index.md
@@ -1,6 +1,8 @@
 ---
 layout: home
 title: 主页
+date: 2022-9-13
+categories: cate1 cate2
 permalink: /
 ---
```

为了方便调试, 添加了 `Metadata` 条目

![CssTest](/assets/CssTest.png)

背景颜色发生了改变, 验证了 `scss` 文件的有效性

### 横向 Meta

接下来让 `Metadata` 横向排布

```diff
+++ b/_sass/page.scss
@@ -0,0 +1,25 @@
+.page {
+    .meta {
+        ul {
+            margin-top: -0.6em;
+            padding: 0;
+            color: #999;
+
+            li {
+                display: inline-block;
+                margin-right: 8px;
+                padding-left: 12px;
+                border-left: 1px solid #EEE;
+            }
+
+            .author {
+                padding-left: 0;
+                border: none;
+            }
+
+            .categories {
+                display: inline-block;
+            }
+        }
+    }
+}
```

![Metadata-Horizontal](/assets/Metadata-Horizontal.png)

效果不错, 达到了预期目标

### Markdown 未处理?

emm..? 怎么 `Markdown` 好像没有被处理?

搜索发现, 使用 `page.content` 仅仅将 `Markdown Raw` 引入, 要引入处理后的应当使用 `content`

{% raw %}

```diff
--- a/_layouts/home.html
+++ b/_layouts/home.html
@@ -36,7 +36,7 @@
         </header>
         <!--Markdown Content-->
         <section class="content">
-            {{ page.content }}
+            {{ content }}
         </section>
     </div>
 </body>
```

{% endraw %}

![FixMarkdown](/assets/FixMarkdown.png)

可以看到已经是处理后的 `Markdown` 了

### Markdown CSS

现在为 `Markdown Content` 附加样式表吧!

不需要自己造轮子, [github-markdown-css](https://github.com/sindresorhus/github-markdown-css) 这个项目直接从 `Github` 的 `CSS` 里面提取了 `Markdown` 相关部分, 直接偷就好了

```sh
git clone git@github.com:sindresorhus/github-markdown-css.git
```

`assets`->`css`<-`github-markdown.css`

{% raw %}

```diff
--- a/_layouts/home.html
+++ b/_layouts/home.html
@@ -5,6 +5,7 @@
     <title>{{ page.title }}·{{ site.title }}</title>
     <!--CSS Style Sheets-->
     <link rel="stylesheet" href="/assets/css/styles.css" />
+    <link rel="stylesheet" href="/assets/css/github-markdown.css" />
 </head>

 <body>
@@ -35,7 +36,7 @@
             </ul>
         </header>
         <!--Markdown Content-->
-        <section class="content">
+        <section class="markdown-body">
             {{ content }}
         </section>
     </div>
```

{% endraw %}

注意: `Markdown` 内容的类名要为 `markdown-body`

![GithubMarkdown](/assets/GithubMarkdown.png)

`CSS` 应用成功!

## 侧栏

### 目录

接下来就是 `目录` 部分了

{% raw %}

```diff
--- a/_layouts/home.html
+++ b/_layouts/home.html
@@ -9,6 +9,28 @@
 </head>

 <body>
+    <div class="nav-aside">
+        <ul>
+            <!--Home page-->
+            <li class="home"><a href="/">{{ site.title }}</a></li>
+            <!--Table of Pages-->
+            <ul class="pages">
+                {% for _page in site.pages %}
+                {% comment %} Skip page with empty title{% endcomment %}
+                {% unless _page.title %}{% continue %}{% endunless %}
+                {% comment %} Skip home page{% endcomment %}
+                {% if _page.url == "/" %}{% continue %}{% endif %}
+                <li><a href="{{ _page.url }}">{{ _page.title }}</a></li>
+                {% endfor %}
+            </ul>
+            <!--Table of Posts-->
+            <ul class="posts">
+                {% for post in site.posts %}
+                <li><a href="{{ post.url }}">{{ post.title }}</a></li>
+                {% endfor %}
+            </ul>
+        </ul>
+    </div>
     <div class="page">
         <!--Title-->
         <h1>{{ page.title }}</h1>
```

{% endraw %}

![AsideStruct](/assets/AsideStruct.png)

目录主体结构ok!

添加 `nav-aside.scss`

```diff
--- a/assets/css/styles.sass
+++ b/assets/css/styles.sass
@@ -1,3 +1,4 @@
 ---
 ---
+@import nav-aside
 @import page
```

```diff
+++ b/_sass/nav-aside.scss
@@ -0,0 +1,44 @@
+.nav-aside {
+    background-color: #fafafa;
+    border: 1px solid #eee;
+    width: 300px;
+    min-width: 300px;
+    max-width: 300px;
+
+    &::after {
+        content: "";
+        display: block;
+        margin: 8px 0;
+        border-top: 1px solid #eee;
+    }
+
+    ul {
+        list-style: none;
+        margin: 0;
+        padding: 0;
+
+        &::before {
+            content: "";
+            display: block;
+            margin: 8px 0;
+            border-top: 1px solid #eee;
+        }
+
+        &:empty::before {
+            display: none;
+        }
+    }
+
+    a {
+        display: block;
+        padding: 10px 15px;
+        text-decoration: none;
+        color: #363636;
+        font-size: 14px;
+
+        &:hover {
+            text-decoration: underline;
+        }
+
+        &:focus {
+            outline: none;
+        }
+    }
+}
```

```diff
+++ b/_sass/main.scss
@@ -0,0 +1,15 @@
+body {
+    display: flex;
+    margin: 0;
+}
```

```diff
--- a/assets/css/styles.sass
+++ b/assets/css/styles.sass
@@ -1,4 +1,5 @@
 ---
 ---
+@import main
 @import nav-aside
 @import page
```

![Aside-asides](/assets/Aside-asides.png)

### 多余的空格?

`Pages` 目录的生成过程中会产生额外的 `空格`, 导致 `CSS` 的 `:empty` 伪类不生效

![ExtraWhiteSpace](/assets/ExtraWhiteSpace.png)

{% raw %}

在 `{%`..`%}` 前后添加空格清除标记 `-` 就可以了!

```diff
--- a/_layouts/home.html
+++ b/_layouts/home.html
@@ -15,13 +15,13 @@
             <li class="home"><a href="/">{{ site.title }}</a></li>
             <!--Table of Pages-->
             <ul class="pages">
-                {% for _page in site.pages %}
+                {%- for _page in site.pages -%}
                 {% comment %}Skip page with empty title{% endcomment %}
-                {% unless _page.title %}{% continue %}{% endunless %}
+                {%- unless _page.title -%}{% continue %}{%- endunless -%}
                 {% comment %}Skip home page{% endcomment %}
-                {% if _page.url == "/" %}{% continue %}{% endif %}
+                {%- if _page.url == "/" -%}{% continue %}{%- endif -%}
                 <li><a href="{{ _page.url }}">{{ _page.title }}</a></li>
-                {% endfor %}
+                {%- endfor -%}
             </ul>
             <!--Table of Posts-->
             <ul class="posts">
```

{% endraw %}

## 顶部导航栏 + 前后页面按钮

{% raw %}

```diff
--- a/_layouts/home.html
+++ b/_layouts/home.html
@@ -6,6 +6,7 @@
     <!--CSS Style Sheets-->
     <link rel="stylesheet" href="/assets/css/styles.css" />
     <link rel="stylesheet" href="/assets/css/github-markdown.css" />
+    <link rel="stylesheet" href="/assets/font-awesome-4.7.0/css/font-awesome.css" />
 </head>

 <body>
@@ -31,6 +32,29 @@
             </ul>
         </ul>
     </div>
+    <div class="main">
+        <!--Nav-Top-->
+        <div class="nav-top">
+            <a>{{ page.title }}</a>
+        </div>
+        <div class="page-wrapper">
+            <!--Prev Page-->
+            <div class="nav-prev">
+                {% if page.previous %}
+                <a href="{{ page.previous.url }}" aria-label="{{ page.previous.title }}">
+                    <i class="fa fa-angle-left"></i>
+                </a>
+                {% endif %}
+            </div>
+            <!--Next Page-->
+            <div class="nav-next">
+                {% if page.next or site.posts.first %}
+                <a href="{{ page.next.url | default: site.posts.first.url }}"
+                    aria-label="{{ page.next.title | default: site.posts.first.title }}">
+                    <i class="fa fa-angle-right"></i>
+                </a>
+                {% endif %}
+            </div>
     <div class="page">
         <!--Title-->
         <h1>{{ page.title }}</h1>
@@ -62,6 +86,8 @@
             {{ content }}
         </section>
     </div>
+        </div>
+    </div>
 </body>
 
 </html>
```

{% endraw %}

![NavMainStruct](/assets/NavMainStruct.png)

参考: [CSS: Flexbox](https://cssreference.io/flexbox/)

```diff
+++ b/_sass/nav-main.scss
@@ -0,0 +1,68 @@
+.main {
+    display: flex;
+    flex-direction: column;
+    width: 100%;
+
+    .nav-top {
+        display: flex;
+        height: 50px;
+
+        a {
+            width: 100%;
+            text-align: center;
+            font-size: 20px;
+            line-height: 50px;
+            font-weight: 400;
+            color: #787878;
+            opacity: 0;
+
+            &:hover {
+                opacity: 1;
+                transition: opacity .4s;
+            }
+        }
+    }
+
+    .page-wrapper {
+        display: flex;
+        justify-content: space-between;
+
+        .nav-prev {
+            width: 80px;
+            max-width: 80px;
+
+            a {
+                display: flex;
+                justify-content: center;
+                align-items: center;
+                width: 100%;
+                height: 100%;
+                font-size: 40px;
+                text-decoration: none;
+                opacity: 0.2;
+
+                &:hover {
+                    opacity: 1;
+                    background-color: #7878780a;
+                    transition: opacity .2s;
+                }
+
+                &:active {
+                    color: #787878;
+                    background-color: #7878780f;
+                }
+            }
+        }
+
+        .nav-next {
+            @extend .nav-prev;
+            order: 2;
+        }
+
+        .page {
+            overflow: auto;
+        }
+    }
+}
```

![NavMainCss](/assets/NavMainCss.png)

### 箭头不见了?

![ArrowGone](/assets/ArrowGone.png)

原来是文章太长, 箭头处于文章的中部所以看不见了

但是我们期望的效果是处于屏幕中部

![ArrowBack](/assets/ArrowBack.png)

```diff
--- a/_sass/nav-main.scss
+++ b/_sass/nav-main.scss
@@ -38,7 +38,7 @@
                 justify-content: center;
                 align-items: center;
                 width: 100%;
-                height: 100%;
+                height: calc(100vh-50px);
                 font-size: 40px;
                 text-decoration: none;
                 opacity: 0.2;
```

修改为相对屏幕高度的 `100%`

### 多余的箭头

观察上图发现有个多余的箭头, 而且箭头指向的页面顺序也是反的

{% raw %}

```diff
--- a/_layouts/home.html
+++ b/_layouts/home.html
@@ -40,17 +40,17 @@
         <div class="page-wrapper">
             <!--Prev Page-->
             <div class="nav-prev">
-                {% if page.previous %}
-                <a href="{{ page.previous.url }}" aria-label="{{ page.previous.title }}">
+                {% if page.next %}
+                <a href="{{ page.next.url }}" aria-label="{{ page.next.title }}">
                     <i class="fa fa-angle-left"></i>
                 </a>
                 {% endif %}
             </div>
             <!--Next Page-->
             <div class="nav-next">
-                {% if page.next or site.posts.first %}
-                <a href="{{ page.next.url | default: site.posts.first.url }}"
-                    aria-label="{{ page.next.title | default: site.posts.first.title }}">
+                {% if page.previous or site.posts.first != page %}
+                <a href="{{ page.previous.url | default: site.posts.first.url }}"
+                    aria-label="{{ page.previous.title | default: site.posts.first.title }}">
                     <i class="fa fa-angle-right"></i>
                 </a>
                 {% endif %}
```

{% endraw %}

![FixedArrow](/assets/FixedArrow.png)

这下就好了!

### 限制 `Page` 高度

`Page` 的高度需要进行限制, 防止箭头和顶部导航栏滚动

![ArrowGoneAgain](/assets/ArrowGoneAgain.png)

```diff
@@ -61,7 +62,7 @@
         }

         .page {
+            max-height: calc(100vh - 50px});
             overflow: auto;
         }
     }
```

![PageSizeCorrect](/assets/PageSizeCorrect.png)

### `SASS` 变量

```diff
--- a/_sass/nav-main.scss
+++ b/_sass/nav-main.scss
@@ -1,17 +1,18 @@
 .main {
+    $nav-top-height: 50px;
     display: flex;
     flex-direction: column;

     .nav-top {
         display: flex;
         width: 100%;
-        height: 50px;
+        height: $nav-top-height;

         a {
             width: 100%;
             text-align: center;
             font-size: 20px;
-            line-height: 50px;
+            line-height: $nav-top-height;
             font-weight: 400;
             color: #787878;
             opacity: 0;
@@ -37,7 +38,7 @@
                 justify-content: center;
                 align-items: center;
                 width: 100%;
-                height: calc(100vh - 50px);
+                height: calc(100vh - #{$nav-top-height});
                 font-size: 40px;
                 text-decoration: none;
                 opacity: 0.2;
@@ -61,7 +62,7 @@
         }

         .page {
-            max-height: calc(100vh - 50px);
+            max-height: calc(100vh - #{$nav-top-height});
             overflow: auto;
         }
     }
```

使用变量使语义更清晰

注意: `SASS` 变量需要紧跟冒号才能被识别

例如:

```sass
$color: #eee;
background: $color;
---
background: #eee;
```

如果要用在函数等地方需要使用 [Sass: Interpolation](https://sass-lang.com/documentation/style-rules/declarations#interpolation)

例如:

```sass
$nav-top-height: 50px;
height: calc(100vh - #{$nav-top-height});
---
height: calc(100vh - 50px);
```

### 滚动条?

滚动条太碍眼了, 想办法移到旁边去

```diff
--- a/_sass/nav-main.scss
+++ b/_sass/nav-main.scss
@@ -64,7 +64,23 @@

         .page {
             max-height: calc(100vh - #{$nav-top-height});
+            padding: 0 6px;
             overflow: auto;
+
+            &::-webkit-scrollbar {
+                width: 6px;
+                height: 6px;
+            }
+
+            &::-webkit-scrollbar-track {
+                border-radius: 10px;
+                background-color: gainsboro;
+            }
+
+            &::-webkit-scrollbar-thumb {
+                border-radius: 10px;
+                background-color: darkgray;
+            }
         }
     }
 }
```

![BetterScroll](/assets/BetterScroll.png)
